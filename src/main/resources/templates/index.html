<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Index</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container-fluid pt-3">
        <!-- Title -->
        <div class="d-block p-2 bg-primary text-white mb-3 mt-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-lg" viewBox="0 0 16 16">
                <path d="m9.708 6.075-3.024.379-.108.502.595.108c.387.093.464.232.38.619l-.975 4.577c-.255 1.183.14 1.74 1.067 1.74.72 0 1.554-.332 1.933-.789l.116-.549c-.263.232-.65.325-.905.325-.363 0-.494-.255-.402-.704zm.091-2.755a1.32 1.32 0 1 1-2.64 0 1.32 1.32 0 0 1 2.64 0"/>
            </svg>
            Basic Information
        </div>

        <form action="manual-resume" method="GET">
            <!-- Basic Info Input -->
            <div class="pt-3 d-grid gap-3">
                <input type="text" class="form-control mb-4" placeholder="Name" name="name" required>
                <input type="text" class="form-control mb-4" placeholder="Title" name="title" required>
                <input type="text" class="form-control mb-4" placeholder="Email" name="email" required>
                <input type="text" class="form-control mb-4" placeholder="Phone Number" name="phone" required>
                <input type="text" class="form-control mb-4" placeholder="Location" name="location" required>
                <input type="text" class="form-control mb-4" placeholder="LinkedIn" name="linkedin">
                <input type="text" class="form-control mb-4" placeholder="GitHub" name="github">
                <input type="text" class="form-control mb-4" placeholder="Website" name="website">
            </div>

            <div class="d-block p-2 bg-warning text-black mb-3 mt-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-mortarboard-fill" viewBox="0 0 16 16">
                    <path d="M8.211 2.047a.5.5 0 0 0-.422 0l-7.5 3.5a.5.5 0 0 0 .025.917l7.5 3a.5.5 0 0 0 .372 0L14 7.14V13a1 1 0 0 0-1 1v2h3v-2a1 1 0 0 0-1-1V6.739l.686-.275a.5.5 0 0 0 .025-.917z"/>
                    <path d="M4.176 9.032a.5.5 0 0 0-.656.327l-.5 1.7a.5.5 0 0 0 .294.605l4.5 1.8a.5.5 0 0 0 .372 0l4.5-1.8a.5.5 0 0 0 .294-.605l-.5-1.7a.5.5 0 0 0-.656-.327L8 10.466z"/>
                </svg>
                Education
            </div>
            <div id="education-container">
                <div class="pt-3 d-grid gap-3 education-entry d-none" id="education-template">
                    <input type="text" class="form-control" data-field="degree" placeholder="Degree and Program">
                    <input type="text" class="form-control" data-field="institution_name" placeholder="School">
                    <input type="text" class="form-control" data-field="start_time" placeholder="Start Date">
                    <input type="text" class="form-control" data-field="end_time" placeholder="End Date">
                    <input type="text" class="form-control" data-field="school_location" placeholder="Location">
                    <input type="text" class="form-control" data-field="gpa" placeholder="GPA (not required)">
                    <div class="awards-container"></div>
                    <div class="courses-container"></div>
                    <button type="button" class="btn btn-outline-secondary" onclick="addAward(this)">Add Award</button>
                    <button type="button" class="btn btn-outline-secondary" onclick="addCourse(this)">Add Course</button>
                    <button type="button" class="btn btn-outline-danger delete-education-btn mb-3">Delete</button>
                </div>
            </div>
            <div class="d-grid gap-2 mb-2">
                <button type="button" class="btn btn-outline-primary" onclick="addEducation()">Add Education</button>
            </div>

            <!-- Title -->
            <div class="d-block p-2 bg-info text-black mb-3 mt-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-workspace" viewBox="0 0 16 16">
                    <path d="M4 16s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1zm4-5.95a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5"/>
                    <path d="M2 1a2 2 0 0 0-2 2v9.5A1.5 1.5 0 0 0 1.5 14h.653a5.4 5.4 0 0 1 1.066-2H1V3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v9h-2.219c.554.654.89 1.373 1.066 2h.653a1.5 1.5 0 0 0 1.5-1.5V3a2 2 0 0 0-2-2z"/>
                </svg>
                Extracurricular & Leadership
            </div>
            <div id="experience-container">
                <div class="pt-3 d-grid gap-3 experience-entry d-none" id="experience-template">
                    <input type="text" class="form-control" data-field="title" placeholder="Title">
                    <input type="text" class="form-control" data-field="company" placeholder="Company/Employer">
                    <input type="text" class="form-control" data-field="start" placeholder="Start">
                    <input type="text" class="form-control" data-field="end" placeholder="End">
                    <input type="text" class="form-control" data-field="location" placeholder="Location">
                    <div class="detail-container"></div>
                    <button type="button" class="btn btn-outline-secondary" onclick="addDetail(this)">Add Detail</button>
                    <button type="button" class="btn btn-outline-danger delete-experience-btn mb-3">Delete</button>
                </div>
                <!-- Render experiences if present -->
                <div th:each="experience : ${experienceList}">
                    <h5 th:text="${experience.title}"></h5>
                    <div>
                        <span th:text="${experience.company}"></span>
                        <span th:text="${experience.start}"></span> - <span th:text="${experience.end}"></span>
                        <span th:text="${experience.location}"></span>
                    </div>
                    <ul class="mt-2" th:if="${experience.details != null and !experience.details.isEmpty()}">
                      <li th:each="detail : ${experience.details}">
                        <span contenteditable="true" th:text="${detail}"></span>
                      </li>
                    </ul>
                </div>
            </div>
            <div class="d-grid gap-2 mb-2">
                <button type="button" class="btn btn-outline-primary" onclick="addExperience()">Add Experience</button>
            </div>

            <!-- Title -->
            <div class="d-block p-2 bg-success text-white mb-3 mt-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-patch-check-fill" viewBox="0 0 16 16">
                    <path d="M10.067.87a2.89 2.89 0 0 0-4.134 0l-.622.638-.89-.011a2.89 2.89 0 0 0-2.924 2.924l.01.89-.636.622a2.89 2.89 0 0 0 0 4.134l.637.622-.011.89a2.89 2.89 0 0 0 2.924 2.924l.89-.01.622.636a2.89 2.89 0 0 0 4.134 0l.622-.637.89.011a2.89 2.89 0 0 0 2.924-2.924l-.01-.89.636-.622a2.89 2.89 0 0 0 0-4.134l-.637-.622.011-.89a2.89 2.89 0 0 0-2.924-2.924l-.89.01zm.287 5.984-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708.708"/>
                </svg>
                Certification
            </div>
            <div id="certification-container">
                <div class="pt-3 d-grid gap-3 certification-entry">
                    <div class="input-group mb-2"></div>
                    <button type="button" class="btn btn-outline-secondary mb-3" onclick="addCertification()">
                        Add Certification
                    </button>
                </div>
            </div>
            <!-- Title -->
            <div class="d-block p-2 bg-dark text-white mb-3 mt-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cast" viewBox="0 0 16 16">
                    <path d="m7.646 9.354-3.792 3.792a.5.5 0 0 0 .353.854h7.586a.5.5 0 0 0 .354-.854L8.354 9.354a.5.5 0 0 0-.708 0"/>
                    <path d="M11.414 11H14.5a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.5-.5h-13a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .5.5h3.086l-1 1H1.5A1.5 1.5 0 0 1 0 10.5v-7A1.5 1.5 0 0 1 1.5 2h13A1.5 1.5 0 0 1 16 3.5v7a1.5 1.5 0 0 1-1.5 1.5h-2.086z"/>
                </svg>
                Project
            </div>
            <div id="project-container">
                <div class="pt-3 d-grid gap-3 experience-entry d-none" id="project-template">
                    <input type="text" class="form-control" data-field="name" placeholder="Project Name">
                    <input type="text" class="form-control" data-field="creator" placeholder="Organization/Creator">
                    <input type="text" class="form-control" data-field="start" placeholder="Start">
                    <input type="text" class="form-control" data-field="end" placeholder="End">
                    <div class="detail-container"></div>
                    <button type="button" class="btn btn-outline-secondary" onclick="addDetail(this)">Add Detail</button>
                    <button type="button" class="btn btn-outline-danger delete-experience-btn mb-3">Delete</button>
                </div>
                <!-- Render projects if present -->
                <div th:each="project : ${projectList}">
                    <h5 th:text="${project.name}"></h5>
                    <div>
                        <span th:text="${project.creator}"></span>
                        <span th:text="${project.start}"></span> - <span th:text="${project.end}"></span>
                    </div>
                    <ul class="mt-2" th:if="${project.details != null and !project.details.isEmpty()}">
                      <li th:each="detail : ${project.details}">
                        <span contenteditable="true" th:text="${detail}"></span>
                      </li>
                    </ul>
                </div>
            </div>
            <div class="d-grid gap-2 mb-2">
                <button type="button" class="btn btn-outline-primary" onclick="addProject()">Add Project</button>
            </div>
            <!-- Title -->
            <div class="d-block p-2 bg-danger text-white mb-3 mt-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-crosshair" viewBox="0 0 16 16">
                    <path d="M8.5.5a.5.5 0 0 0-1 0v.518A7 7 0 0 0 1.018 7.5H.5a.5.5 0 0 0 0 1h.518A7 7 0 0 0 7.5 14.982v.518a.5.5 0 0 0 1 0v-.518A7 7 0 0 0 14.982 8.5h.518a.5.5 0 0 0 0-1h-.518A7 7 0 0 0 8.5 1.018zm-6.48 7A6 6 0 0 1 7.5 2.02v.48a.5.5 0 0 0 1 0v-.48a6 6 0 0 1 5.48 5.48h-.48a.5.5 0 0 0 0 1h.48a6 6 0 0 1-5.48 5.48v-.48a.5.5 0 0 0-1 0v.48A6 6 0 0 1 2.02 8.5h.48a.5.5 0 0 0 0-1zM8 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4"/>
                </svg>
                Skill
            </div>
            <div id="skill-container">
                <div class="pt-3 d-grid gap-3 certification-entry">
                    <button type="button" class="btn btn-outline-secondary mb-3" onclick="addSkill()">
                        Add Skill
                    </button>
                </div>
            </div>
            <div class="d-grid gap-2 mb-2">
                <button type="submit" class="btn btn-primary">Generate Resume</button>
            </div>
        </form>
    </div>
<script>
function setupDeleteButtons(context) {
    context.querySelectorAll('.delete-education-btn, .delete-experience-btn').forEach(btn => {
        btn.onclick = () => btn.closest('.education-entry, .experience-entry').remove();
    });
}

function addEducation() {
    const container = document.getElementById('education-container');
    const template = document.getElementById('education-template');
    const clone = template.cloneNode(true);
    clone.classList.remove('d-none');
    clone.removeAttribute('id');

    clone.querySelectorAll('input').forEach(input => input.value = '');

    const index = container.querySelectorAll('.education-entry:not(.d-none)').length;
    clone.querySelectorAll('input').forEach(input => {
        const field = input.getAttribute('data-field');
        if (field) {
            input.name = `educationList[${index}].${field}`;
        }
    });

    clone.querySelector('.awards-container').innerHTML = '';
    clone.querySelector('.courses-container').innerHTML = '';
    setupDeleteButtons(clone);
    container.appendChild(clone);
}

function addAward(btn) {
    const entry = btn.closest('.education-entry');
    const index = Array.from(document.querySelectorAll('.education-entry:not(.d-none)')).indexOf(entry);
    const container = entry.querySelector('.awards-container');
    const wrapper = document.createElement('div');
    wrapper.className = 'input-group mb-2';

    const input = document.createElement('input');
    input.type = 'text';
    input.name = `educationList[${index}].awards[${container.children.length}]`;
    input.className = 'form-control';
    input.placeholder = 'Award Name';

    const button = document.createElement('button');
    button.type = 'button';
    button.className = 'btn btn-outline-danger';
    button.textContent = 'Delete';
    button.onclick = () => wrapper.remove();

    wrapper.appendChild(input);
    wrapper.appendChild(button);
    container.appendChild(wrapper);
}

function addCourse(btn) {
    const entry = btn.closest('.education-entry');
    const index = Array.from(document.querySelectorAll('.education-entry:not(.d-none)')).indexOf(entry);
    const container = entry.querySelector('.courses-container');
    const wrapper = document.createElement('div');
    wrapper.className = 'input-group mb-2';

    const input = document.createElement('input');
    input.type = 'text';
    input.name = `educationList[${index}].relevantCourses[${container.children.length}]`;
    input.className = 'form-control';
    input.placeholder = 'Relevant Course';

    const button = document.createElement('button');
    button.type = 'button';
    button.className = 'btn btn-outline-danger';
    button.textContent = 'Delete';
    button.onclick = () => wrapper.remove();

    wrapper.appendChild(input);
    wrapper.appendChild(button);
    container.appendChild(wrapper);
}

function addCertification() {
    const container = document.getElementById('certification-container');
    const wrapper = document.createElement('div');
    wrapper.className = 'input-group mb-2';

    const input = document.createElement('input');
    input.type = 'text';
    input.name = 'certificateList';
    input.className = 'form-control';
    input.placeholder = 'Certification';

    const button = document.createElement('button');
    button.type = 'button';
    button.className = 'btn btn-outline-danger';
    button.textContent = 'Delete';
    button.onclick = () => wrapper.remove();

    wrapper.appendChild(input);
    wrapper.appendChild(button);
    container.appendChild(wrapper);
}

function addExperience() {
    const container = document.getElementById('experience-container');
    const template = document.getElementById('experience-template');
    const clone = template.cloneNode(true);
    clone.classList.remove('d-none');
    clone.removeAttribute('id');

    clone.querySelectorAll('input').forEach(input => input.value = '');

    // Correct index calculation (remove -1)
    const index = container.querySelectorAll('.experience-entry:not(.d-none)').length;
    clone.setAttribute('data-index', index);
    clone.querySelectorAll('input').forEach(input => {
        const field = input.getAttribute('data-field');
        if (field) {
            input.name = `experienceList[${index}].${field}`;
        }
    });

    clone.querySelector('.detail-container').innerHTML = '';
    setupDeleteButtons(clone);
    container.appendChild(clone);
}

function addProject() {
    const container = document.getElementById('project-container');
    const template = document.getElementById('project-template');
    const clone = template.cloneNode(true);
    clone.classList.remove('d-none');
    clone.removeAttribute('id');

    clone.querySelectorAll('input').forEach(input => input.value = '');

    // Correct index calculation (remove -1)
    const index = container.querySelectorAll('#project-container .experience-entry:not(.d-none)').length;
    clone.setAttribute('data-index', index);
    clone.querySelectorAll('input').forEach(input => {
        const field = input.getAttribute('data-field');
        if (field) {
            input.name = `projectList[${index}].${field}`;
        }
    });

    clone.querySelector('.detail-container').innerHTML = '';
    setupDeleteButtons(clone);
    container.appendChild(clone);
}

function addDetail(button) {
    const entry = button.closest('.experience-entry');
    // Determine if this is a project or experience entry for correct index calculation
    const isProject = entry.closest('#project-container') !== null;
    const containerList = isProject
        ? document.querySelectorAll('#project-container .experience-entry')
        : document.querySelectorAll('#experience-container .experience-entry');
    const index = entry.getAttribute('data-index');
    const container = entry.querySelector('.detail-container');
    const wrapper = document.createElement('div');
    wrapper.className = 'input-group mb-2';

    const input = document.createElement('input');
    input.type = 'text';
    input.name = `${isProject ? 'projectList' : 'experienceList'}[${index}].details[${container.children.length}]`;
    input.className = 'form-control';
    input.placeholder = 'Describe your achievement or responsibility';

    const deleteBtn = document.createElement('button');
    deleteBtn.type = 'button';
    deleteBtn.className = 'btn btn-outline-danger';
    deleteBtn.textContent = 'Delete';
    deleteBtn.onclick = () => wrapper.remove();

    wrapper.appendChild(input);
    wrapper.appendChild(deleteBtn);
    container.appendChild(wrapper);
}

function addSkill() {
    const container = document.getElementById('skill-container');
    const wrapper = document.createElement('div');
    wrapper.className = 'input-group mb-2';

    const input = document.createElement('input');
    input.type = 'text';
    input.name = 'skills';
    input.className = 'form-control';
    input.placeholder = 'Skill';

    const button = document.createElement('button');
    button.type = 'button';
    button.className = 'btn btn-outline-danger';
    button.textContent = 'Delete';
    button.onclick = () => wrapper.remove();

    wrapper.appendChild(input);
    wrapper.appendChild(button);
    container.appendChild(wrapper);
}

document.addEventListener('DOMContentLoaded', () => {
    setupDeleteButtons(document);
});
</script>
</body>
</html>